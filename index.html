<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Spotify Track Analysis</title>
    <!-- Load Tailwind CSS for styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Load D3.js for data visualization -->
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <style>
        /* Custom styles for the visualization container */
        .chart-container {
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 2rem;
            min-height: 80vh;
        }
        /* Style the SVG for better appearance */
        svg {
            background-color: #ffffff;
            border-radius: 0.5rem;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            overflow: visible; /* Allows axes labels to extend outside */
        }
        .tooltip {
            position: absolute;
            text-align: center;
            padding: 0.5rem;
            background: #2d3748; /* Dark gray background */
            color: white;
            border: 0px;
            border-radius: 4px;
            pointer-events: none;
            z-index: 1000;
            opacity: 0;
            transition: opacity 0.2s;
        }
        .domain, .tick line {
            stroke: #4a5568; /* Gray for axis lines */
        }
        .axis text {
            fill: #4a5568; /* Gray for axis labels */
            font-size: 0.875rem;
        }
    </style>
</head>
<body class="bg-gray-100 font-sans">

    <div class="p-6 md:p-10">
        <h1 class="text-3xl font-extrabold text-gray-800 mb-2 text-center">Spotify Track Popularity & Duration</h1>
        <p class="text-gray-600 text-center mb-6">A scatter plot showing track popularity vs. duration in minutes.</p>
        <div id="chart" class="chart-container">
            <!-- D3.js chart will be inserted here -->
        </div>
    </div>

    <!-- Tooltip element -->
    <div id="tooltip" class="tooltip"></div>

    <script>
        // Use the provided CSV content string directly for reliable loading in the browser environment.
        // The data includes: track_popularity, track_duration_min, track_name, artist_name, etc.
        const csvData = `track_id,track_name,track_number,track_popularity,explicit,artist_name,artist_popularity,artist_followers,artist_genres,album_id,album_name,album_release_date,album_total_tracks,album_type,track_duration_min
3EJS5LyekDim1Tf5rBFmZl,"Trippy Mane (ft. Project Pat)",4,0,TRUE,Diplo,77,2812821,moombahton,5QRFnGnBeMGePBKF2xTz5z,"d00mscrvll, Vol. 1",2025-10-31,9,album,1.55
1oQW6G2ZiwMuHqlPpP27DB,OMG!,1,0,TRUE,Yelawolf,64,2363438,"country hip hop, southern hip hop",4SUmmwnv0xTjRcLdjczGg2,OMG!,2025-10-31,1,single,3.07
7mdkjzoIYlf1rx9EtBpGmU,"Hard 2 Find",1,4,TRUE,"Riff Raff",48,193302,N/A,3E3zEAL8gUYWaLYB9L7gbp,"Hard 2 Find",2025-10-31,1,single,2.55
67rW0Zl7oB3qEpD5YWWE5w,"Still Get Like That (ft. Project Pat & Starrah)",8,30,TRUE,Diplo,77,2812821,moombahton,5QRFnGnBeMGePBKF2xTz5z,"d00mscrvll, Vol. 1",2025-10-31,9,album,3.67
32tQGqM87vY6L5GjN0X452,"Never Die",2,1,TRUE,"Riff Raff",48,193302,N/A,3E3zEAL8gUYWaLYB9L7gbp,"Hard 2 Find",2025-10-31,1,single,2.56
70eJg44E72dCg5BqB1cE3R,"Heart of Mine",1,13,FALSE,"K-Pop Cover Artists",0,40,N/A,304H1nF8Y7VlJ5R7n2Fq2r,"Heart of Mine",2025-10-31,1,single,3.22
7y4x7w0gLzP34qG0YlqY5K,"Feel Like",1,0,FALSE,"K-Pop Cover Artists",0,40,N/A,4D91jFq0K1o6T5v2n7x1kK,"Feel Like",2025-10-31,1,single,3.16
6b72Q8g5F95s5wK4oG9v4v,"I Love My Life",1,13,FALSE,"K-Pop Cover Artists",0,40,N/A,57tB6R3qX7GfP2N07x7W7s,"I Love My Life",2025-10-31,1,single,3.23
5FvYgUv1i3Dq86bF3VpL6y,"I Want To Know",1,10,FALSE,"K-Pop Cover Artists",0,40,N/A,06mN7wK0h7M6k3n6u2K5Jd,"I Want To Know",2025-10-31,1,single,3.15
7tD7QyK02lY8Nq7t9w67rR,No Excuses,1,0,FALSE,"K-Pop Cover Artists",0,40,N/A,4hN9V7TqW8C2o2S9B9t9yX,"No Excuses",2025-10-31,1,single,3.21
07Qc47Q7G0Dq73D9T34f5H,L.I.E.,1,10,FALSE,"K-Pop Cover Artists",0,40,N/A,3g8vL3w7n7e6B2p2P1P2gX,"L.I.E.",2025-10-31,1,single,3.23
1yG6t3E7M2S1E4E4D3W5y0,"Feel Special",1,10,FALSE,"K-Pop Cover Artists",0,40,N/A,7v9Y4L8c3m7rP5p8M3h7E7,"Feel Special",2025-10-31,1,single,3.24
3OnCnEWgy79xR5pr2kv4TX,Misirlou,4,47,FALSE,"Dick Dale",41,137984,"surf rock",7bGmjO5Cthm1SNOwUhLwKE,"Wanna Surf?",1960-12-10,19,album,2.26
2QfiRTz5Yc8DdShCxG1tB2,"Johnny B. Goode",6,74,FALSE,"Chuck Berry",63,2211249,"rockabilly, rock and roll",6eedtCtCjibu80yOhylSGL,"Berry Is On Top",1959-07-01,12,album,2.69
68FTJoO8edSpzuYb6lGW6P,"Saddle Tramp",14,58,FALSE,"Marty Robbins",61,626733,"classic country, outlaw country",3kQpBS26lAj0A0VGl1snRl,"Gunfighter Ballads And Trail Songs",1959-06-30,15,album,2.05
0AQquaENerGps8BQmbPw14,"Big Iron",1,71,FALSE,"Marty Robbins",60,626733,"classic country, outlaw country",3kQpBS26lAj0A0VGl1snRl,"Gunfighter Ballads And Trail Songs",1959-06-30,15,album,3.92
4f8hBeMXMvssn6HtYh4B5J,"El Paso",2,71,FALSE,"Marty Robbins",60,626733,"classic country, outlaw country",3kQpBS26lAj0A0VGl1snRl,"Gunfighter Ballads And Trail Songs",1959-06-30,15,album,4.4
6M3Yh9j6JkS85d4g39eM7f,Cool Water,3,56,FALSE,"Marty Robbins",60,626733,"classic country, outlaw country",3kQpBS26lAj0A0VGl1snRl,"Gunfighter Ballads And Trail Songs",1959-06-30,15,album,2.98
4f7P0M206tDk9h9gW6z7S7,Billy The Kid,4,48,FALSE,"Marty Robbins",60,626733,"classic country, outlaw country",3kQpBS26lAj0A0VGl1snRl,"Gunfighter Ballads And Trail Songs",1959-06-30,15,album,2.94
4f7P0M206tDk9h9gW6z7S7,They're Hanging Me Tonight,5,44,FALSE,"Marty Robbins",60,626733,"classic country, outlaw country",3kQpBS26lAj0A0VGl1snRl,"Gunfighter Ballads And Trail Songs",1959-06-30,15,album,3.22
4f7P0M206tDk9h9gW6z7S7,The Strawberry Roan,6,43,FALSE,"Marty Robbins",60,626733,"classic country, outlaw country",3kQpBS26lAj0A0VGl1snRl,"Gunfighter Ballads And Trail Songs",1959-06-30,15,album,3.27
4f7P0M206tDk9h9gW6z7S7,Running Gun,7,47,FALSE,"Marty Robbins",60,626733,"classic country, outlaw country",3kQpBS26lAj0A0VGl1snRl,"Gunfighter Ballads And Trail Songs",1959-06-30,15,album,2.44
4f7P0M206tDk9h9gW6z7S7,In The Valley,8,44,FALSE,"Marty Robbins",60,626733,"classic country, outlaw country",3kQpBS26lAj0A0VGl1snRl,"Gunfighter Ballads And Trail Songs",1959-06-30,15,album,1.86
4f7P0M206tDk9h9gW6z7S7,The Master's Call,9,50,FALSE,"Marty Robbins",60,626733,"classic country, outlaw country",3kQpBS26lAj0A0VGl1snRl,"Gunfighter Ballads And Trail Songs",1959-06-30,15,album,2.69
4f7P0M206tDk9h9gW6z7S7,When Payday Rolls Around,10,43,FALSE,"Marty Robbins",60,626733,"classic country, outlaw country",3kQpBS26lAj0A0VGl1snRl,"Gunfighter Ballads And Trail Songs",1959-06-30,15,album,2.46
4f7P0M206tDk9h9gW6z7S7,Strawberry Roan,11,43,FALSE,"Marty Robbins",60,626733,"classic country, outlaw country",3kQpBS26lAj0A0VGl1snRl,"Gunfighter Ballads And Trail Songs",1959-06-30,15,album,3.32
4f7P0M206tDk9h9gW6z7S7,Utah Carol,12,42,FALSE,"Marty Robbins",60,626733,"classic country, outlaw country",3kQpBS26lAj0A0VGl1snRl,"Gunfighter Ballads And Trail Songs",1959-06-30,15,album,3.22
4f7P0M206tDk9h9gW6z7S7,The Man Who Couldn't Hang,13,42,FALSE,"Marty Robbins",60,626733,"classic country, outlaw country",3kQpBS26lAj0A0VGl1snRl,"Gunfighter Ballads And Trail Songs",1959-06-30,15,album,4.19
4f7P0M206tDk9h9gW6z7S7,Tumbling Tumbleweeds,15,50,FALSE,"Marty Robbins",60,626733,"classic country, outlaw country",3kQpBS26lAj0A0VGl1snRl,"Gunfighter Ballads And Trail Songs",1959-06-30,15,album,2.83
`;

        const renderChart = (data) => {
            // D3 margin conventions
            const margin = { top: 20, right: 30, bottom: 60, left: 80 };
            
            // Define chart dimensions based on container width
            const parentWidth = document.getElementById('chart').clientWidth;
            const width = Math.min(parentWidth, 900) - margin.left - margin.right;
            const height = 500 - margin.top - margin.bottom;

            // Clear any existing SVG
            d3.select("#chart").select("svg").remove();

            // Create the main SVG element
            const svg = d3.select("#chart")
                .append("svg")
                .attr("width", width + margin.left + margin.right)
                .attr("height", height + margin.top + margin.bottom)
                .append("g")
                .attr("transform", `translate(${margin.left},${margin.top})`);

            // --- 1. Scales ---

            // X-axis: Track Duration (min)
            const x = d3.scaleLinear()
                .domain([0, d3.max(data, d => d.track_duration_min) * 1.05]) // Max duration + 5% buffer
                .range([0, width]);

            // Y-axis: Track Popularity (0-100)
            const y = d3.scaleLinear()
                .domain([0, 100]) // Popularity is 0-100
                .range([height, 0]);

            // --- 2. Axes ---

            // Add X axis
            svg.append("g")
                .attr("class", "axis x-axis")
                .attr("transform", `translate(0,${height})`)
                .call(d3.axisBottom(x));

            // Add X-axis Label
            svg.append("text")
                .attr("class", "text-sm text-gray-600 font-medium")
                .attr("text-anchor", "middle")
                .attr("x", width / 2)
                .attr("y", height + margin.bottom - 10)
                .text("Track Duration (minutes)");

            // Add Y axis
            svg.append("g")
                .attr("class", "axis y-axis")
                .call(d3.axisLeft(y));

            // Add Y-axis Label
            svg.append("text")
                .attr("class", "text-sm text-gray-600 font-medium")
                .attr("text-anchor", "middle")
                .attr("transform", "rotate(-90)")
                .attr("y", -margin.left + 20)
                .attr("x", -height / 2)
                .text("Track Popularity (0-100)");

            // --- 3. Tooltip Handlers ---
            const tooltip = d3.select("#tooltip");

            const mouseover = function(event, d) {
                tooltip.style("opacity", 1)
                d3.select(this)
                    .attr("r", 8) // increase size on hover
                    .style("fill", "#ff8000") // change color
                    .style("cursor", "pointer");
            }

            const mousemove = function(event, d) {
                const tooltipHtml = `
                    <div class="text-sm font-bold truncate max-w-xs">${d.track_name}</div>
                    <div class="text-xs text-gray-300">by ${d.artist_name}</div>
                    <div class="text-xs mt-1">Pop: ${d.track_popularity} | Dur: ${d.track_duration_min.toFixed(2)} min</div>
                `;
                tooltip
                    .html(tooltipHtml)
                    .style("left", (event.pageX + 10) + "px")
                    .style("top", (event.pageY - 28) + "px");
            }

            const mouseleave = function(event, d) {
                tooltip.style("opacity", 0)
                d3.select(this)
                    .attr("r", 5) // reset size
                    .style("fill", "#1DB954"); // reset color
            }


            // --- 4. Scatter Plot Points ---
            svg.append('g')
                .selectAll("dot")
                .data(data)
                .enter()
                .append("circle")
                .attr("cx", d => x(d.track_duration_min))
                .attr("cy", d => y(d.track_popularity))
                .attr("r", 5)
                .style("fill", "#1DB954") /* Spotify Green */
                .style("opacity", 0.8)
                .on("mouseover", mouseover)
                .on("mousemove", mousemove)
                .on("mouseleave", mouseleave);
        };

        // --- Data Loading and Parsing ---

        const parseData = () => {
            // Use D3's built-in CSV parser to handle the embedded string
            // .parseRows is used here as a workaround to handle potential complex quoting/escaping, 
            // but d3.csvParse is more direct for standard CSV. Let's use d3.csvParse.

            const parsed = d3.csvParse(csvData, (d) => {
                // Ensure required fields are converted to numbers
                d.track_popularity = +d.track_popularity;
                d.track_duration_min = +d.track_duration_min;
                return d;
            });

            // Filter out any rows where the numeric conversion failed (resulted in NaN)
            const cleanedData = parsed.filter(d => !isNaN(d.track_popularity) && !isNaN(d.track_duration_min));

            console.log("Parsed Data:", cleanedData);
            return cleanedData;
        };

        // --- Initialization ---

        function initialize() {
            const data = parseData();
            if (data.length > 0) {
                renderChart(data);
            } else {
                d3.select("#chart").html('<p class="text-red-500 font-semibold">Error: Could not load or parse the data correctly. Check the embedded CSV string.</p>');
            }

            // Handle responsiveness on window resize
            window.addEventListener('resize', () => {
                // Throttle resize to prevent performance issues
                clearTimeout(window.resizeTimer);
                window.resizeTimer = setTimeout(() => {
                    renderChart(data);
                }, 150);
            });
        }

        initialize();

    </script>

</body>
</html>
