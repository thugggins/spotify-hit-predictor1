<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Spotify Data Filter</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .controls { margin-bottom: 20px; display: flex; gap: 20px; align-items: center; }
        .controls label, .controls select { font-size: 16px; }
        table { width: 100%; border-collapse: collapse; }
        th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
        th { background-color: #f2f2f2; cursor: pointer; }
        button { padding: 10px 15px; background-color: #f44336; color: white; border: none; cursor: pointer; border-radius: 4px; }
        button:hover { background-color: #d32f2f; }
        .select-group { display: flex; flex-direction: column; }
    </style>
</head>
<body>

    <h1>Spotify Data Explorer</h1>

    <div class="controls">
        <div class="select-group">
            <label for="artist-filter">Filter by Artist:</label>
            <select id="artist-filter" onchange="applyFilters()">
                <option value="">All Artists</option>
                </select>
        </div>
        <div class="select-group">
            <label for="genre-filter">Filter by Genre:</label>
            <select id="genre-filter" onchange="applyFilters()">
                <option value="">All Genres</option>
                </select>
        </div>
        
        <button onclick="resetFilters()">Reset All Filters</button>
    </div>

    <p>Showing <span id="record-count">0</span> Tracks.</p>

    <table>
        <thead>
            <tr>
                <th>Track Name</th>
                <th>Artist Name</th>
                <th>Genre</th>
                <th>Popularity</th>
                <th>Duration (min)</th>
            </tr>
        </thead>
        <tbody id="data-table-body">
            </tbody>
    </table>

    <script>
        // 1. EMBED YOUR DATA HERE
        // Paste the full JSON output from the previous step here.
        // NOTE: This snippet is truncated for brevity. Use your full data.
        const spotifyData = [
            {"track_name":"Trippy Mane (ft. Project Pat)","artist_name":"Diplo","artist_genres":"moombahton","track_popularity":0,"track_duration_min":1.55},
            {"track_name":"OMG!","artist_name":"Yelawolf","artist_genres":"country hip hop, southern hip hop","track_popularity":0,"track_duration_min":3.07},
            {"track_name":"Hard 2 Find","artist_name":"Riff Raff","artist_genres":null,"track_popularity":4,"track_duration_min":2.55},
            {"track_name":"Still Get Like That (ft. Project Pat & Starrah)","artist_name":"Diplo","artist_genres":"moombahton","track_popularity":30,"track_duration_min":1.69},
            {"track_name":"ride me like a harley","artist_name":"Rumelis","artist_genres":"dark r&b","track_popularity":0,"track_duration_min":2.39},
            // ... approximately 8000 more records here ...
        ];

        let availableArtists = new Set();
        let availableGenres = new Set();
        const tableBody = document.getElementById('data-table-body');
        const artistFilter = document.getElementById('artist-filter');
        const genreFilter = document.getElementById('genre-filter');
        const recordCount = document.getElementById('record-count');

        // 2. INITIALIZE FILTERS AND TABLE
        function initializeData() {
            // Extract unique artists and genres for the filter lists
            spotifyData.forEach(track => {
                availableArtists.add(track.artist_name);
                
                // Handle multiple genres per track (comma-separated list)
                if (track.artist_genres) {
                    track.artist_genres.split(', ').forEach(genre => {
                        availableGenres.add(genre.trim());
                    });
                }
            });

            // Populate the dropdowns
            populateFilter(artistFilter, Array.from(availableArtists).sort());
            populateFilter(genreFilter, Array.from(availableGenres).sort());

            // Render the initial table with all data
            renderTable(spotifyData);
        }

        function populateFilter(selectElement, optionsArray) {
            optionsArray.forEach(optionText => {
                // Ignore empty or null entries
                if (optionText && optionText.length > 0) {
                    const option = document.createElement('option');
                    option.value = optionText;
                    option.textContent = optionText;
                    selectElement.appendChild(option);
                }
            });
        }

        // 3. FILTERING LOGIC
        function applyFilters() {
            const selectedArtist = artistFilter.value;
            const selectedGenre = genreFilter.value;
            
            // Start with the full dataset
            let filteredData = spotifyData;

            // Apply Artist Filter
            if (selectedArtist) {
                filteredData = filteredData.filter(track => track.artist_name === selectedArtist);
            }

            // Apply Genre Filter
            if (selectedGenre) {
                filteredData = filteredData.filter(track => 
                    // Check if the track's genre string contains the selected genre
                    track.artist_genres && track.artist_genres.includes(selectedGenre)
                );
            }

            // Update the display
            renderTable(filteredData);
        }

        // 4. RENDERING LOGIC
        function renderTable(data) {
            // Clear existing table content
            tableBody.innerHTML = '';
            
            // Update the record count
            recordCount.textContent = data.length;

            data.forEach(track => {
                const row = tableBody.insertRow();
                
                // Add cells for the desired columns
                row.insertCell().textContent = track.track_name;
                row.insertCell().textContent = track.artist_name;
                // Display only the first genre for a clean look, or 'N/A'
                row.insertCell().textContent = track.artist_genres ? track.artist_genres.split(', ')[0] : 'N/A';
                row.insertCell().textContent = track.track_popularity;
                row.insertCell().textContent = track.track_duration_min.toFixed(2);
            });
        }

        // 5. THE RESET FUNCTIONALITY (Clears everything)
        function resetFilters() {
            // Reset the select elements to the default "All" option
            artistFilter.value = ""; 
            genreFilter.value = ""; 

            // Re-render the table with the original, full dataset
            renderTable(spotifyData);

            console.log("Filters reset. All data restored.");
        }

        // Run the initialization function when the page loads
        document.addEventListener('DOMContentLoaded', initializeData);
    </script>
</body>
</html>
